{
  "id": "kafka-order-processor",
  "name": "Kafka Order Processor",
  "description": "Processes order events from Kafka topic and performs order validation and fulfillment",
  "nodes": [
    {
      "id": "orders-kafka-trigger",
      "name": "Orders Kafka Trigger",
      "node_type": "trigger:kafka",
      "category": "trigger",
      "config": {
        "brokers": ["localhost:29092"],
        "consumer_group": "operion-order-processor",
        "topic": "orders"
      },
      "source_id": "18a00f62-93fc-4512-92ad-6899337c2e4a",
      "provider_id": "kafka",
      "event_type": "message_received",
      "position_x": 50,
      "position_y": 100,
      "enabled": true
    },
    {
      "id": "log-incoming-order",
      "name": "Log Incoming Order",
      "node_type": "log",
      "category": "action",
      "config": {
        "level": "info",
        "message": "Processing order from Kafka - Topic: {{.trigger_data.topic}}, Partition: {{.trigger_data.partition}}, Offset: {{.trigger_data.offset}}, Order ID: {{.trigger_data.message.order_id}}"
      },
      "position_x": 100,
      "position_y": 100,
      "enabled": true
    },
    {
      "id": "validate-order-data",
      "name": "Validate Order Data",
      "node_type": "transform",
      "category": "action",
      "config": {
        "expression": "{ \"order_id\": \"{{.trigger_data.message.order_id}}\", \"customer_id\": \"{{.trigger_data.message.customer_id}}\", \"total_amount\": {{.trigger_data.message.total_amount}}, \"status\": \"{{.trigger_data.message.status}}\", \"timestamp\": \"{{.trigger_data.timestamp}}\", \"is_valid\": {{ and (ne .trigger_data.message.order_id \"\") (ne .trigger_data.message.customer_id \"\") (gt .trigger_data.message.total_amount 0.0) }} }"
      },
      "position_x": 300,
      "position_y": 100,
      "enabled": true
    },
    {
      "id": "process-valid-order",
      "name": "Process Valid Order",
      "node_type": "httprequest",
      "category": "action",
      "config": {
        "url": "{{ $order := index .node_results \"validate-order-data\" }}{{.variables.order_api_base}}/{{ $order.order_id }}/process",
        "method": "POST",
        "timeout": "{{.variables.timeout}}",
        "headers": {
          "Authorization": "Bearer {{.env.ORDER_API_TOKEN}}",
          "Content-Type": "application/json"
        },
        "body": "{{ $order := index .node_results \"validate-order-data\" }}{\n  \"order_id\": \"{{ $order.order_id }}\",\n  \"customer_id\": \"{{ $order.customer_id }}\",\n  \"amount\": {{ $order.total_amount }},\n  \"kafka_metadata\": {\n    \"topic\": \"{{.trigger_data.topic}}\",\n    \"partition\": {{.trigger_data.partition}},\n    \"offset\": {{.trigger_data.offset}},\n    \"message_key\": \"{{.trigger_data.message_key}}\"\n  }\n}"
      },
      "position_x": 500,
      "position_y": 100,
      "enabled": true
    },
    {
      "id": "send-order-notification",
      "name": "Send Order Notification",
      "node_type": "httprequest",
      "category": "action",
      "config": {
        "url": "{{.variables.notification_webhook}}",
        "method": "POST",
        "timeout": "{{.variables.timeout}}",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": "{{ $order := index .node_results \"validate-order-data\" }}{{ $process := index .node_results \"process-valid-order\" }}{\n  \"event\": \"order_processed\",\n  \"order_id\": \"{{ $order.order_id }}\",\n  \"customer_id\": \"{{ $order.customer_id }}\",\n  \"processed_at\": \"{{ $order.timestamp }}\",\n  \"processing_status\": {{ $process.status_code }},\n  \"kafka_source\": {\n    \"topic\": \"{{.trigger_data.topic}}\",\n    \"partition\": {{.trigger_data.partition}},\n    \"offset\": {{.trigger_data.offset}}\n  }\n}"
      },
      "position_x": 700,
      "position_y": 100,
      "enabled": true
    },
    {
      "id": "log-invalid-order",
      "name": "Log Invalid Order",
      "node_type": "log",
      "category": "action",
      "config": {
        "level": "error",
        "message": "Invalid order received from Kafka - Order ID: {{.trigger_data.message.order_id}}, Reason: Missing required fields"
      },
      "position_x": 300,
      "position_y": 250,
      "enabled": true
    },
    {
      "id": "log-completion",
      "name": "Log Processing Completion",
      "node_type": "log",
      "category": "action",
      "config": {
        "level": "info",
        "message": "{{ $order := index .node_results \"validate-order-data\" }}{{ $process := index .node_results \"process-valid-order\" }}Order processing completed - Order ID: {{ $order.order_id }}, Valid: {{ $order.is_valid }}, API Status: {{ $process.status_code }}"
      },
      "position_x": 900,
      "position_y": 100,
      "enabled": true
    }
  ],
  "connections": [
    {
      "id": "trigger-to-log",
      "source_port": "orders-kafka-trigger:success",
      "target_port": "log-incoming-order:main"
    },
    {
      "id": "log-to-validate",
      "source_port": "log-incoming-order:success",
      "target_port": "validate-order-data:main"
    },
    {
      "id": "validate-to-process-valid",
      "source_port": "validate-order-data:success",
      "target_port": "process-valid-order:main"
    },
    {
      "id": "validate-to-log-invalid",
      "source_port": "validate-order-data:error",
      "target_port": "log-invalid-order:main"
    },
    {
      "id": "process-to-notify",
      "source_port": "process-valid-order:success",
      "target_port": "send-order-notification:main"
    },
    {
      "id": "notify-to-complete",
      "source_port": "send-order-notification:success",
      "target_port": "log-completion:main"
    }
  ],
  "variables": {
    "notification_webhook": "https://webhooks.example.com/order-notifications",
    "order_api_base": "https://api.example.com/orders",
    "timeout": 30
  },
  "status": "published",
  "workflow_group_id": "kafka-order-processor",
  "published_at": "2023-10-01T00:00:00Z",
  "owner": "",
  "created_at": "2025-08-18T12:16:52.923729Z",
  "updated_at": "2025-08-18T12:16:52.923729Z"
}