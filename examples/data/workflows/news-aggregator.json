{
  "id": "news-aggregator",
  "name": "News Aggregator and Sentiment Analysis",
  "description": "Aggregate news from multiple sources and analyze trends using NewsAPI",
  "status": "active",
  "nodes": [
    {
      "id": "news-schedule",
      "name": "News Schedule Trigger",
      "node_type": "trigger:scheduler",
      "category": "trigger",
      "config": {
        "cron": "0 8,14,20 * * *",
        "timezone": "UTC"
      },
      "enabled": true,
      "provider_id": "scheduler",
      "event_type": "schedule_due",
      "position_x": 50,
      "position_y": 100
    },
    {
      "id": "fetch-top-headlines",
      "name": "Fetch Top Headlines",
      "config": {
        "url": "https://newsapi.org/v2/top-headlines?country={{.variables.country}}&category={{.variables.category}}&pageSize=10&apiKey={{.env.NEWS_API_KEY}}",
        "method": "GET",
        "timeout": 15,
        "headers": {
          "Accept": "application/json",
          "User-Agent": "Operion-NewsAggregator/1.0"
        },
        "retries": {
          "attempts": 3,
          "delay": 2000
        }
      },
      "position_x": 100,
      "position_y": 100,
      "enabled": true,
      "node_type": "httprequest",
      "category": "action"
    },
    {
      "id": "fetch-tech-news",
      "name": "Fetch Technology News",
      "config": {
        "url": "https://newsapi.org/v2/everything?q=technology&language=en&sortBy=publishedAt&pageSize=5&apiKey={{.env.NEWS_API_KEY}}",
        "method": "GET",
        "timeout": 15,
        "headers": {
          "Accept": "application/json",
          "User-Agent": "Operion-NewsAggregator/1.0"
        }
      },
      "position_x": 100,
      "position_y": 250,
      "enabled": true,
      "node_type": "httprequest",
      "category": "action"
    },
    {
      "id": "process-headlines",
      "name": "Process Headlines",
      "config": {
        "expression": "{{ $data := index .node_results \"fetch-top-headlines\" }}{{ $articles := $data.json.articles }}{\n  \"total_articles\": {{ $data.json.totalResults }},\n  \"headlines\": [{{ range $i, $article := slice $articles 0 5 }}{{ if ne $i 0 }},{{ end }}{\n    \"title\": \"{{ $article.title }}\",\n    \"source\": \"{{ $article.source.name }}\",\n    \"published\": \"{{ $article.publishedAt }}\",\n    \"url\": \"{{ $article.url }}\",\n    \"description\": \"{{ $article.description }}\",\n    \"word_count\": {{ len (split $article.title \" \") }}\n  }{{ end }}],\n  \"timestamp\": \"{{now}}\"\n}"
      },
      "position_x": 300,
      "position_y": 100,
      "enabled": true,
      "node_type": "transform",
      "category": "action"
    },
    {
      "id": "process-tech-news",
      "name": "Process Tech News",
      "config": {
        "expression": "{{ $data := index .node_results \"fetch-tech-news\" }}{{ $articles := $data.json.articles }}{\n  \"total_tech_articles\": {{ $data.json.totalResults }},\n  \"tech_articles\": [{{ range $i, $article := slice $articles 0 3 }}{{ if ne $i 0 }},{{ end }}{\n    \"title\": \"{{ $article.title }}\",\n    \"source\": \"{{ $article.source.name }}\",\n    \"published\": \"{{ $article.publishedAt }}\",\n    \"url\": \"{{ $article.url }}\",\n    \"description\": \"{{ $article.description }}\"\n  }{{ end }}],\n  \"timestamp\": \"{{now}}\"\n}"
      },
      "position_x": 300,
      "position_y": 250,
      "enabled": true,
      "node_type": "transform",
      "category": "action"
    },
    {
      "id": "create-news-summary",
      "name": "Create News Summary",
      "config": {
        "expression": "{{ $headlines := index .node_results \"process-headlines\" }}{{ $tech := index .node_results \"process-tech-news\" }}{{ $sources := dict }}{{ range $headlines.headlines }}{{ $sources = set $sources .source true }}{{ end }}{{ range $tech.tech_articles }}{{ $sources = set $sources .source true }}{{ end }}{{ $keywords := dict }}{{ range $headlines.headlines }}{{ range split (lower .title) \" \" }}{{ if gt (len .) 3 }}{{ $keywords = set $keywords . true }}{{ end }}{{ end }}{{ end }}{{ range $tech.tech_articles }}{{ range split (lower .title) \" \" }}{{ if gt (len .) 3 }}{{ $keywords = set $keywords . true }}{{ end }}{{ end }}{{ end }}{\n  \"summary\": {\n    \"timestamp\": \"{{now}}\",\n    \"total_headlines\": {{ $headlines.total_articles }},\n    \"total_tech_articles\": {{ $tech.total_tech_articles }},\n    \"sources\": [{{ $first := true }}{{ range $key, $val := $sources }}{{ if not $first }},{{ end }}\"{{ $key }}\"{{ $first = false }}{{ end }}],\n    \"keywords\": [{{ $first := true }}{{ $count := 0 }}{{ range $key, $val := $keywords }}{{ if and (lt $count 10) $first }}{{ if not $first }},{{ end }}\"{{ $key }}\"{{ $first = false }}{{ $count = add $count 1 }}{{ end }}{{ end }}]\n  },\n  \"top_headlines\": {{ $headlines.headlines | toJson }},\n  \"tech_news\": {{ $tech.tech_articles | toJson }}\n}"
      },
      "position_x": 500,
      "position_y": 175,
      "enabled": true,
      "node_type": "transform",
      "category": "action"
    },
    {
      "id": "log-news-stats",
      "name": "Log News Statistics",
      "config": {
        "message": "{{ $summary := index .node_results \"create-news-summary\" }}News Summary - Headlines: {{ $summary.summary.total_headlines }}, Tech Articles: {{ $summary.summary.total_tech_articles }}, Sources: {{ len $summary.summary.sources }}"
      },
      "position_x": 700,
      "position_y": 175,
      "enabled": true,
      "node_type": "log",
      "category": "action"
    },
    {
      "id": "check-breaking-news",
      "name": "Check Breaking News",
      "config": {
        "expression": "{{ $summary := index .node_results \"create-news-summary\" }}{\n  \"breaking_threshold\": {{.variables.breaking_news_threshold}},\n  \"has_breaking_news\": {{ gt $summary.summary.total_headlines .variables.breaking_news_threshold }},\n  \"alert_message\": \"{{ if gt $summary.summary.total_headlines .variables.breaking_news_threshold }}High news activity detected - {{ $summary.summary.total_headlines }} headlines{{ else }}Normal news activity{{ end }}\"\n}"
      },
      "position_x": 900,
      "position_y": 175,
      "enabled": true,
      "node_type": "transform",
      "category": "action"
    },
    {
      "id": "send-news-digest",
      "name": "Send News Digest",
      "config": {
        "url": "https://httpbin.org/post",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": "{{ $summary := index .node_results \"create-news-summary\" }}{{ $breaking := index .node_results \"check-breaking-news\" }}{\n  \"service\": \"news-aggregator\",\n  \"timestamp\": \"{{ $summary.summary.timestamp }}\",\n  \"summary\": {\n    \"total_headlines\": {{ $summary.summary.total_headlines }},\n    \"total_tech_articles\": {{ $summary.summary.total_tech_articles }},\n    \"unique_sources\": {{ len $summary.summary.sources }},\n    \"top_keywords\": {{ $summary.summary.keywords | toJson }},\n    \"breaking_news_alert\": {{ $breaking.has_breaking_news }}\n  },\n  \"featured_headlines\": {{ $summary.top_headlines | toJson }},\n  \"tech_highlights\": {{ $summary.tech_news | toJson }},\n  \"alert_message\": \"{{ $breaking.alert_message }}\"\n}",
        "timeout": 10
      },
      "position_x": 1100,
      "position_y": 175,
      "enabled": true,
      "node_type": "httprequest",
      "category": "action"
    },
    {
      "id": "log-success",
      "name": "Log Success",
      "config": {
        "message": "{{ $breaking := index .node_results \"check-breaking-news\" }}News aggregation completed. {{ $breaking.alert_message }}"
      },
      "position_x": 1300,
      "position_y": 125,
      "enabled": true,
      "node_type": "log",
      "category": "action"
    },
    {
      "id": "log-headlines-error",
      "name": "Log Headlines Error",
      "config": {
        "message": "Failed to fetch top headlines from NewsAPI"
      },
      "position_x": 300,
      "position_y": 50,
      "enabled": true,
      "node_type": "log",
      "category": "action"
    },
    {
      "id": "log-tech-error",
      "name": "Log Tech News Error",
      "config": {
        "message": "Failed to fetch technology news from NewsAPI"
      },
      "position_x": 300,
      "position_y": 350,
      "enabled": true,
      "node_type": "log",
      "category": "action"
    },
    {
      "id": "log-webhook-error",
      "name": "Log Webhook Error",
      "config": {
        "message": "Failed to send news digest report"
      },
      "position_x": 1300,
      "position_y": 225,
      "enabled": true,
      "node_type": "log",
      "category": "action"
    }
  ],
  "connections": [
    {
      "id": "trigger-news-schedule-to-fetch-top-headlines",
      "source_port": "news-schedule:success",
      "target_port": "fetch-top-headlines:main"
    },
    {
      "id": "headlines-to-tech",
      "source_port": "fetch-top-headlines:success",
      "target_port": "fetch-tech-news:main"
    },
    {
      "id": "headlines-error",
      "source_port": "fetch-top-headlines:error",
      "target_port": "log-headlines-error:main"
    },
    {
      "id": "headlines-to-process",
      "source_port": "fetch-tech-news:success",
      "target_port": "process-headlines:main"
    },
    {
      "id": "tech-error",
      "source_port": "fetch-tech-news:error",
      "target_port": "log-tech-error:main"
    },
    {
      "id": "process-headlines-to-tech",
      "source_port": "process-headlines:success",
      "target_port": "process-tech-news:main"
    },
    {
      "id": "tech-to-summary",
      "source_port": "process-tech-news:success",
      "target_port": "create-news-summary:main"
    },
    {
      "id": "summary-to-log",
      "source_port": "create-news-summary:success",
      "target_port": "log-news-stats:main"
    },
    {
      "id": "log-to-check",
      "source_port": "log-news-stats:success",
      "target_port": "check-breaking-news:main"
    },
    {
      "id": "check-to-send",
      "source_port": "check-breaking-news:success",
      "target_port": "send-news-digest:main"
    },
    {
      "id": "send-success",
      "source_port": "send-news-digest:success",
      "target_port": "log-success:main"
    },
    {
      "id": "send-error",
      "source_port": "send-news-digest:error",
      "target_port": "log-webhook-error:main"
    }
  ],
  "variables": {
    "country": "us",
    "category": "general",
    "breaking_news_threshold": 50
  },
  "metadata": {
    "version": "1.0",
    "author": "Operion",
    "tags": [
      "news",
      "aggregation",
      "newsapi",
      "technology",
      "real-api"
    ],
    "description": "Real news aggregation using NewsAPI. Requires NEWS_API_KEY environment variable.",
    "api_requirements": {
      "newsapi": "Free API key from https://newsapi.org/ - 100 requests/day on free tier"
    }
  }
}